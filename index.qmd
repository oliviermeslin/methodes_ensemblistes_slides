---
title: Introduction aux m√©thodes ensemblistes
subtitle: |
  **Ou comment booster la statistique publique**
author: |
  M√©lina Hillion
  Olivier Meslin
slide-number: true
footer: |
  M√©thodes ensemblistes
# uncomment for French presentations:
lang: fr-FR
# for blind readers:
slide-tone: false
# for @olevitt:
chalkboard: # press the B key to toggle chalkboard
  theme: whiteboard
# uncomment to use the multiplex mode:
#multiplex: true
format:
  # pick the light mode (onyxia-revealjs) or the dark mode (onyxia-dark-revealjs)
  onyxia-revealjs
  #onyxia-dark-revealjs:
controls: true
css: custom.css
from: markdown+emoji
---

# Intro

## Une belle intro {.smaller}


Friedman 2001, Breiman 2001

XGBoost, LightGBM

## Rattraper le retard pris par la statistique publique {.smaller}

Les m√©thodes ensemblistes sont bien adapt√©es aux travaux de la statistique publique:

- Omnipr√©sence de __[donn√©es tabulaires]{.blue2}__;
- Multiplicit√© des __[cas d'usage]{.blue2}__:
    - __[Classification binaire]{.orange}__: correction de la non-r√©ponse dans les enqu√™tes, rep√©rage d'_outliers_, mod√©lisation, imputation (ex: emploi/ch√¥mage); 
    - __[Classification multiclasse]{.orange}__: imputation (ex: niveau de dipl√¥me);
    - __[R√©gression]{.orange}__: imputation de variables continues (√¢ge, salaires, heures travaill√©es, prix immobiliers), pr√©diction de s√©ries temporelles, lissage spatial...

. . .

Ces m√©thodes restent pourtant __[peu utilis√©es par la statistique publique]{.blue2}__.

## Que voulons-nous faire? {.smaller}

- __[Objectif p√©dagogique]{.orange}__: __[faciliter l'appropriation de ces m√©thodes]{.blue2}__ par la statistique publique $\Rightarrow$ Ce n'est pas un travail de recherche.

. . .

- __[Public]{.orange}__: les __[agents de la statistique publique qui connaissent les cas d'usage et ma√Ætrisent les m√©thodes √©conom√©triques traditionnelles]{.blue2}__, mais sont peu familiers du _machine learning_.

. . .

- __[D√©marche]{.orange}__: faire une __[pr√©sentation d√©taill√©e des m√©thodes ensemblistes]{.blue2}__, assortie de cas d'usage montrant leur apport aux travaux de la statistique publique.

## Champ couvert (1) {.smaller}

- Objectif: [__pr√©senter en d√©tail un nombre r√©duit d'approches__]{.blue2}:
    - CART;
    - _Bagging_ et for√™ts al√©atoires;
    - _Gradient boosting_.


- M√©thodes non couvertes:
    - _Stacking_;
    - _Boosting_ adaptatif.

## Champ couvert (2) {.smaller}


- Objectif: [__pr√©senter quelques m√©thodes d'interpr√©tabilit√©__]{.blue2}:
    - Approches globales (PDP, ALE plots);
    - Approches locales (valeurs de Shapley, LIME);

- Non couvert: mesure de l'incertitude (notamment la pr√©diction conforme).

## Approche p√©dagogique (1) {.smaller}


- Objectif: [__Couvrir toutes les √©tapes de l'appropriation de ces m√©thodes__]{.blue2}:
    - Pr√©sentation intuitive des m√©thodes;
    - Approche math√©matique d√©taill√©e (reprenant Friedman 2001 et Chen et Guestrin 2016);
    - Pr√©sentation des principaux hyper-param√®tres et de leur lien avec les cas d'usage;
    - Mise en oeuvre pratique.


## Exemple de figures: CART

![](./figures/output2.svg)

## Exemple de figures: for√™t al√©atoire

![](./figures/output4.svg)

## Exemple de figures: _gradient boosting_

![](./figures/output5.svg)

## Approche p√©dagogique (2) {.smaller}

- Objectif: [__Proposer diff√©rents cas d'usage tir√©s de la statistique publiques__]{.blue2}n avec des exemples reproductibles reposant sur des donn√©es ouvertes (autant que possible).
    

## Cas d'usage


- Scope du DT.

- Cas d'usage;
    - Classification/r√©gression
    - Repond√©ration dans les enqu√™tes;
    - Lissage spatial => Fid√©limmo

- organisation des cas d'usage.



# Cas d'usage

## Imputation de valeurs manquantes {.smaller}

- Qu'est-ce que l'imputation ?
  - Affecter une valeur "plausible" √† une valeur manquantes

- Quand imputer ?
  - En pr√©sence de non-r√©ponse partielle

- Pourquoi imputer ?
  - R√©duire les biais (de non-r√©ponse) des estimateurs
  - (R√©duire la variance des estimateurs)
  - Eviter d'avoir un jeu de pond√©ration par variable

- Quels enjeux ?
  - Qualit√© des donn√©es diffus√©es 
  - Variables imput√©es parfois utilis√©es pour imputer les valeurs manquantes d'autres variables (risque d'erreurs "en cascade")



## Imputation de valeurs manquantes {.smaller}

- Hypoth√®ses fondamentales:
  - Il existe un mod√®le reliant les variables √† imputer √† des variables auxiliaires
  - Les param√®tres de ce mod√®le peuvent √™tres estim√©s sur la population des r√©pondants

- Quels d√©terminants de la qualit√© d'imputation ?
  - Valeur pr√©dictive des variables auxilaires 
  - Performance du mod√®le pr√©dictif utilis√©

- Quels risques?
  - Introduction de biais suppl√©mentaires
  - Distorsion de la distribution des variables d'int√©r√™t
  - Att√©nuation des relations entre variables
  - Sous-estimation de la variance des estimateurs


## Imputation de valeurs manquantes {.smaller}

- Deux grandes familles de m√©thodes d'imputation
  - M√©thode al√©atoire
  - M√©thode d√©terministe

- Pour une mutlitude d'approches!
  - colddeck, moyenne, r√©gression, ratio, plus proche voisin ...
  - hotdeck, ratio/r√©gression avec r√©sidus ...
  
- Quelle valeur ajout√©e (esp√©r√©e) des m√©thodes ensemblistes?
  - Une g√©n√©ralisation du mod√®le d'estimation par la r√©gression
  - Avec une performance pr√©dictive sup√©rieure:
    - Non lin√©arit√©
    - Gestion des valeurs manquantes dans les variables auxiliaires
  
  
  
## Imputation de valeurs manquantes {.smaller}

Application : l'imputation des valeurs manquantes dans le recensement de la population

- La m√©thode actuelle: 
  - imputation al√©atoire s√©quentielle par "hot deck"
  - Traitement "lots par lots"

- Principe:
  - les logements, les individus et les variables sont trait√©s les uns apr√®s les autres dans un ordre pr√©-√©tabli
  - Les variables imput√©es peuvent √™tre utilis√©es pour imputer d'autres variables
  - Les individus donneurs peuvent √™tre choisis sur la base de valeurs imput√©es
  


## Imputation de valeurs manquantes {.smaller}

Application : l'imputation des valeurs manquantes dans le recensement de la population

- En pratique:
  - Individus tri√©s selon une cl√© primaire qui refl√®te leur proximit√© g√©ographique
  - Imputation par le plus proche voisin (au sens du tri), d√©j√† redress√©, ayant des caract√©ristiques proches et pour lequel la variable √† redresser est remplie
  - Imputation d√©terministe en cas d'absence de donneur ou d'incoh√©rence
  
- Avantages:
  - Simplicit√©, rapidit√©
  
- Limites:
  - Peu de variables auxillaires utilis√©es
  - Pouvoir pr√©dictif am√©liorable (nombre et partionnement des variables auxiliaires)


## Imputation de valeurs manquantes {.smaller}

- Application propos√©e
  - Utiliser les donn√©es publiques du recensement (d√©j√† imput√©es)
  - Comparer les performances pr√©dictives de la m√©thode d'imputation actuelle (hotdesc s√©quentiel), d'un logit et d'un xgboost √† partir des m√™mes variables
  
- Exemple: le niveau de dipl√¥me
  - Hypoth√®ses actuelles: le dipl√¥me d‚Äôun individu d√©pend de son √¢ge, de sa nationalit√© et de son sexe

  
## Imputation de valeurs manquantes {.smaller}

- Pourquoi une meilleure pr√©diction avec la m√©thode xgboost ?
  - Utiliser des variables auxilaires non imput√©es
  - Mieux partitionner (s√©lection de variables, croisements, et regroupements de modalit√©s)
  
- Avantages attendus  
  - Mieux pr√©server les relations entre variables?
  - R√©duire la variance des r√©sidus et am√©liorer la pr√©cision des estimateurs ?

- Limites de la m√©thode xgboost
  - Temps de calcul?
  
- Questions en suspens
  - Le pouvoir pr√©dictif est-il le principal crit√®re ? (vs simplicit√©, rapidit√©)
  
  



## Repond√©ration {.smaller}

- Qu'est-ce que la repond√©ration ?
  - Affecter un poids √† chaque individu afin de corriger les biais de non-r√©ponse

- Quand repond√©rer ?
  - En pr√©sence de non-r√©ponse totale

- Les principales m√©thodes actuellement utilis√©es
  - Les m√©thodes des groupes de r√©ponse homog√®ne
    - Les arbres de d√©cison (algorithme CHAID appliqu√© √† la variable la plus corr√©l√©e √† la non-r√©ponse)
    - Les m√©thodes de score (logit puis partitionnement)
  - Le calage sur marges en une √©tape



## Repond√©ration {.smaller}

- Application: la repond√©ration de l'enqu√™te patrimoine
  
- M√©thode actuelle: m√©thode des scores 
  - Probabilit√© de r√©ponse du m√©nage mod√©lis√©e par un mod√®le logit utilisant les variables de la base de sondage (pr√©diction)
  - Construction des groupes de m√©nages avec une probabilit√© de r√©ponse proche (classification)
  - Au sein de chaque groupes, le poids de sondage des r√©pondants est multipli√© par l‚Äôinverse du taux de r√©ponse du groupe
  
- Proposition:
  - Utiliser les m√™mes variables
  - Remplace la partie pr√©dictive (logit) par une m√©thode de bagging (random forest) ou de boosting
  


## Lissage spatial {.smaller}





# Le Funathon

## Principe {.smaller}

:::: {.columns}

::: {.column width="70%"}

::: {.incremental}

- __[4 sujets]{.blue2}__ pour d√©couvrir diff√©rents champs de la _data science_
    + Pas une comp√©tition mais des [tutoriels pas √† pas]{.orange}
    + Mais n'h√©sitez pas √† tester des choses nouvelles üòç <br><br>
- [**_"D√©collage imminent pour la data science"_**]{.blue2}
    + Th√©matique : statistiques sur l'aviation civile
    + Organisation: √©quipes innovation de l'Insee & DGAC <br><br>
- __Point d'entr√©e__ : [inseefrlab.github.io/funathon2024/](https://inseefrlab.github.io/funathon2024/)

:::

:::

::: {.column width="30%"}

![](https://inseefrlab.github.io/funathon2024/img/best_image_funathon.png)

:::

::::

::: {.callout-note collapse="true"}
## Ressources de l'an dernier

L'ensemble des ressources de l'an dernier (_"Du champ √† l'assiette"_) peut √™tre retrouv√©e sur [inseefrlab.github.io/funathon2023/](https://inseefrlab.github.io/funathon2023/)

:::

## Modalit√©s pratiques {.smaller}

- __[√âv√©nement üíØ% virtuel sur 2 jours]{.blue2}__:
    + [Premier jour]{.orange}: introduction √† __9h30__ ;
    + [Deuxi√®me jour]{.orange}: fin du travail sur les sujets √† __16h30__, restitution et conclusion ensuite 

. . .


- __[Assistance sur Tchap et Zoom]{.blue2}__ (liens üëáÔ∏è):
    + Assistance garantie: 10h-17h30 (sauf le midi üçî) ;
    + Ne restez pas bloqu√©s, [posez des questions !]{.orange}

:burger:

::: {.callout-note}
## Liens utiles

- [Canal `Tchap` `Funathon 2024`](https://matrix.to/#/#funathon2024:agent.finances.tchap.gouv.fr)
- [Canal `Zoom`](https://insee-fr.zoom.us/j/94735555913?pwd=dEtLQjg2Y1QrRzl3ei95dkRyOEVXdz09) sur les deux jours
:::

## Les 4 sujets {.smaller}

- __[Ressources {{< fa brands r-project >}} et {{< fa brands python >}} sur *open data* de la DGAC]{.blue2}__ :
  + [2 sujets]{.orange} permettent de faire du {{< fa brands r-project >}}
  + [3 sujets]{.orange} permettent de faire du {{< fa brands python >}}
  + Niveaux techniques indiqu√©s sur les sujets

. . .

- Tutoriels complets __[avec corrections]{.blue2}__
  + Cherchez avant de regarder la correction, c'est le meilleur apprentissage !
  + Objectif secondaire: __[se former √† `Git` {{< fa brands git-alt >}} et √† la reproductibilit√©]{.blue2}__


::: {.callout-note}
## Plus de fun en √©quipe üò∫

N'h√©sitez pas √† traiter les sujets en √©quipe
:::

## Les 4 sujets

__Pr√©sentation des 4 sujets__

![Retrouver les sujets sur [inseefrlab.github.io/funathon2024/](https://inseefrlab.github.io/funathon2024/)](img/sujets_funathon2024.png)


# Le SSP Cloud, c'est quoi ?


## Un environnement id√©al pour la formation {.smaller}

- Plateforme disponible depuis <https://datalab.sspcloud.fr/>
    + Pour d√©couvrir et exp√©rimenter... 
    + ... **Seulement avec des donn√©es en open data**

. . .

- Une plateforme pour l'administration :
    + Ouverte aux agents de l'Etat et √† des formations en _data science_ (ENSAE...)
    + Des serveurs h√©berg√©s √† l'Insee

. . .

::: {.callout-important}

__Plateforme recommand√©e pour cet √©v√©nement__

- Signalez-nous si vous ne pouvez cr√©er de compte !

:::


## Questions
